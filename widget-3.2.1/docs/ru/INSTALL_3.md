# Установка 3.0
С 3 версии меняются адреса и способ установки виджета. Установка старой версии описана на странице [Установка 2.0](INSTALL_2.md)

## Навигация
- [Введение](INTRO.md)
- Установка 3.0 (эта страница)
- [Установка 2.0](INSTALL_2.md)
- [Настройка 3.0](SETUP_3.md)
- [Настройка 2.0](SETUP_2.md)
- [Миграция 2.0 => 3.0](MIGRATION_2_3.md)

## Авторизация и настройка
Необходимо скопировать на веб сервер файл [service.php](../../dist/service.php) таким образом, чтобы он был доступен по прямой ссылке (например, https://some-site.com/service.php).
Для корректного расчета стоимости доставки виджету необходимы авторизационные данные для доступа к сервису интеграции СДЭК. Чтобы получить данные по Аккаунту интеграции нужно в личном кабинете, в разделе Интеграция нажать кнопку «Создать ключ», затем в разделе интеграция появится Идентификатор аккаунта и Пароль.
Чтобы ввести данные, откройте файл `service.php`. Данные вводятся в 7-й (account) и 12-й (key) строках внутри пустых кавычек.

## Подключение скриптов
Для подключения виджета необходимо на нужную страницу добавить код `<script type="text/javascript" src="https://cdn.jsdelivr.net/gh/cdek-it/widget@latest/dist/cdek-widget.umd.js" charset="utf-8"></script>`. Рекомендуется его расположить внутри тега `<head>`.

Конкретную версию подгружаемого виджета можно выбирать. Приведенный выше пример автоматически подгружает latest - последнюю версию. Соответственно, при каждом выпуске автором новой версии - он будет обновляться автоматически. Данный вариант подключения не рекомендуется для использования в продуктивной среде.

Версии виджета создаются в формате semver: `<цифра мажорной версии>.<цифра минорной версии>.<цифра патча>`. 
- Если вы хотите автоматически получать патчи-исправления ошибок в виджете, которые не затронут уже существующий функционал (но и не добавят нового функционала), то в src подгружаемого скрипта необходимо указать первые две цифры версии, вместо latest. Например:
`<script type="text/javascript" src="https://cdn.jsdelivr.net/gh/cdek-it/widget@3.0/dist/cdek-widget.umd.js" charset="utf-8"></script>`
- Если вы хотите автоматически получать патчи-исправления ошибок и новый функционал, который является обратно совместимым, т.е. гарантированно не сломает уже существующий виджет, то в src подгружаемого скрипта необходимо указать первую цифру версии, вместо latest. Например: `<script type="text/javascript" src="https://cdn.jsdelivr.net/gh/cdek-it/widget@3/dist/cdek-widget.umd.js" charset="utf-8"></script>`
- Если вы не хотите автоматически получать новый код, то в src подгружаемого скрипта необходимо указать полную версию, вместо latest. Например: `<script type="text/javascript" src="https://cdn.jsdelivr.net/gh/cdek-it/widget@3.0.0/dist/cdek-widget.umd.js" charset="utf-8"></script>`

## Получение ключа Яндекс.Карт
Для использования виджета, необходимо получить АПИ-ключ Яндекс.Карт. В противном случае, виджет не будет отображаться. Процесс генерации ключа описан на странице: https://yandex.ru/dev/jsapi-v2-1/doc/ru/#get-api-key. Обязательно задайте параметр HTTP Referrer равный адресу вашего сайта для ключа.

## Размещение виджета на странице
На страницу необходимо добавить элемент, в который будет встроен виджет. Данному элементу следует указать высоту, иначе он может принять значение высоты равной 0 и виджет на странице не будет видно.
`<div id="cdek-map" style="width:800px;height:600px"></div>`
Далее необходимо создать обработчик для инициализации виджета. В нем необходимо указать желаемую конфигурацию виджета, а также ссылку на файл `service.php`, размещенный на вашем сервере. Обработчик с минимальным числом параметров будет выглядеть так:
```html
<script type="text/javascript">
  new window.CDEKWidget({ from: 'Новосибирск', root: 'cdek-map', apiKey: 'yandex-api-key', servicePath: 'https://some-site.com/service.php', defaultLocation: 'Новосибирск' });
</script>
```

Обработчик инициализации виджета необходимо вызывать, когда элемент с указанным ID элемента уже существует на странице, иначе он будет создан повторно.

Далее необходимо провести настройку виджета в соответствии с информацией со страницы [Настройка 3.0](SETUP_3.md)
